package ivr.parser;

import java.io.File;
import java.util.Date;
import java.util.HashMap;
import org.apache.log4j.Logger;


import com.sforce.soap.enterprise.sobject.Campania_Avon__c;
import com.sforce.soap.enterprise.sobject.Contact;
import com.sforce.soap.enterprise.sobject.Movimiento__c;


public class ManParser {

	protected Logger logger = Logger.getLogger(this.getClass());
	private HashMap<String, Movimiento__c> mapMan;

		public StringBuffer messages = null;
		protected File fMAN2610 = null;

public void setupParser() {
}
public ManParser(File fMAN2610, String ivMan) {
	super(fMAN2610);
}
@Override
void item(String[] campos) {
	
		Movimiento__c ivr = new Movimiento__c();
		
		String registro =campos[2].trim();
		String key =fMAN2610.getName() + registro;

		Contact rep = new Contact();
		rep.setRegistro__c(registro);
		ivr.setRepresentante__r(rep);
		
		ivr.setTipo_Modificacion__c("Ficha");
		ivr.setExternal_Id_c__c(key);
		ivr.setMotivo__c(campos[5].trim());

		//Parseo de fecha 
		String sdate = campos[9].trim();
		Date fechaIVR = null;
		try{
			fechaIVR = super.getDate(sdate, "MM/dd/yyyy");
		}catch(Exception e){
			logger.error("Error parseando la fecha:" + sdate);
		}
		ivr.setFecha_IVR__c(fechaIVR);
		
		String campania = campos[4].trim() + fechaIVR.getTime();
		Campania_Avon__c cam = new Campania_Avon__c();
		cam.setExternal_Id__c(campania);
		ivr.setA_Campania__r(cam);
		
		String campaniados = campos[7].trim();
		Campania_Avon__c campdos = new Campania_Avon__c();
		campdos.setExternal_Id__c(campaniados);
		ivr.setA_Campania__r(cam);
		
		ivr.setAutorizacion_IVR__c(campos[10].trim());
		ivr.setDigitos__c(campos[11].trim());
		
		if(mapMan==null){
			mapMan = new HashMap<String, Movimiento__c>();
		}
		mapMan.putAll(getmapMan());
	}		
public HashMap<String, Movimiento__c> getmapMan() {
	return mapMan;
	}

	
}
